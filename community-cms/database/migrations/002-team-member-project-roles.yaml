databaseChangeLog:
  - changeSet:
      id: 002-1-create-team-members-table
      author: Lex
      changes:
        - createTable:
            tableName: team_members
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: full_name, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: position, type: VARCHAR(100)}
              - column: {name: bio, type: TEXT}
              - column: {name: avatar_path, type: VARCHAR(500)}
              - column: {name: sort_order, type: INT, defaultValueNumeric: 0}
              - column: {name: active, type: BOOLEAN, defaultValueBoolean: true}
              - column: {name: email, type: VARCHAR(100)}
              - column: {name: phone, type: VARCHAR(50)}
              - column: {name: social_links, type: TEXT}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}
              - column: {name: updated_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"}

  - changeSet:
      id: 002-2-create-team-member-project-roles-table
      author: Lex
      changes:
        - createTable:
            tableName: team_member_project_roles
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: team_member_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: project_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: role, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: created_at, type: TIMESTAMP, defaultValueComputed: "CURRENT_TIMESTAMP"}

        - addUniqueConstraint:
            tableName: team_member_project_roles
            columnNames: team_member_id, project_id
            constraintName: uk_team_member_project

  - changeSet:
      id: 002-3-add-foreign-keys-for-roles
      author: Lex
      changes:
        - addForeignKeyConstraint:
            baseTableName: team_member_project_roles
            baseColumnNames: team_member_id
            referencedTableName: team_members
            referencedColumnNames: id
            constraintName: fk_tmpr_team_member
            onDelete: CASCADE
            onUpdate: CASCADE

        - addForeignKeyConstraint:
            baseTableName: team_member_project_roles
            baseColumnNames: project_id
            referencedTableName: projects
            referencedColumnNames: id
            constraintName: fk_tmpr_project
            onDelete: CASCADE
            onUpdate: CASCADE

  - changeSet:
      id: 002-4-create-indexes
      author: Lex
      changes:
        - createIndex:
            indexName: idx_team_members_active
            tableName: team_members
            columns:
              - column: {name: active}

        - createIndex:
            indexName: idx_team_members_sort_order
            tableName: team_members
            columns:
              - column: {name: sort_order}

        - createIndex:
            indexName: idx_tmpr_member_id
            tableName: team_member_project_roles
            columns:
              - column: {name: team_member_id}

        - createIndex:
            indexName: idx_tmpr_project_id
            tableName: team_member_project_roles
            columns:
              - column: {name: project_id}