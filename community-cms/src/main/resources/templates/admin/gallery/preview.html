<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ –≥–∞–ª–µ—Ä–µ–∏ - –ê–¥–º–∏–Ω–∫–∞ Community CMS</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        .preview-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .preview-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .media-preview {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 8px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .info-badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
        }

        .metadata-item {
            border-bottom: 1px solid #e9ecef;
            padding: 0.75rem 0;
        }

        .metadata-item:last-child {
            border-bottom: none;
        }

        .action-buttons .btn {
            margin: 0.2rem;
        }

        @media (max-width: 768px) {
            .preview-header {
                padding: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
                margin: 0.2rem 0;
            }
        }
    </style>
</head>
<body>
<div class="container-fluid py-4">

    <!-- –ó–ê–ì–û–õ–û–í–û–ö –° –ù–ê–í–ò–ì–ê–¶–ò–ï–ô -->
    <div class="preview-header">
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a th:href="@{/admin}" class="text-white-50 text-decoration-none">üìä –î–∞—à–±–æ—Ä–¥</a></li>
                <li class="breadcrumb-item"><a th:href="@{/admin/gallery}" class="text-white-50 text-decoration-none">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è</a></li>
                <li class="breadcrumb-item active text-white">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h1 class="h2 mb-2">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–∞</h1>
                <p class="mb-0 opacity-90">–ü—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ –≥–∞–ª–µ—Ä–µ–∏ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π</p>
            </div>
            <div class="mt-2 mt-md-0">
                <a th:href="@{/admin/gallery}" class="btn btn-light me-2">
                    <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </a>
                <a th:href="@{/admin/gallery/edit/{id}(id=${galleryItem.id})}" class="btn btn-outline-light">
                    <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </a>
            </div>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card preview-card">
                <div class="card-body p-0">

                    <!-- –°–¢–ê–¢–£–°–ù–ê–Ø –ü–ê–ù–ï–õ–¨ -->
                    <div class="bg-light border-bottom p-3">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="mb-1" th:text="${galleryItem.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞</h4>
                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                    <!-- –°–¢–ê–¢–£–° –ü–£–ë–õ–ò–ö–ê–¶–ò–ò -->
                                    <span th:if="${galleryItem.published}" class="badge bg-success info-badge">
                                        <i class="bi bi-eye me-1"></i>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
                                    </span>
                                    <span th:unless="${galleryItem.published}" class="badge bg-secondary info-badge">
                                        <i class="bi bi-eye-slash me-1"></i>–ß–µ—Ä–Ω–æ–≤–∏–∫
                                    </span>

                                    <!-- –¢–ò–ü –ú–ï–î–ò–ê -->
                                    <span th:if="${galleryItem.mediaType.name() == 'PHOTO'}"
                                          class="badge bg-info info-badge">
                                        <i class="bi bi-image me-1"></i>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
                                    </span>
                                    <span th:if="${galleryItem.mediaType.name() == 'VIDEO'}"
                                          class="badge bg-warning text-dark info-badge">
                                        <i class="bi bi-play-circle me-1"></i>–í–∏–¥–µ–æ
                                    </span>

                                    <!-- –ö–ê–¢–ï–ì–û–†–ò–Ø -->
                                    <span class="badge bg-primary info-badge" th:text="${galleryItem.category}">
                                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                                    </span>

                                    <!-- –ì–û–î -->
                                    <span class="badge bg-dark info-badge">
                                        <i class="bi bi-calendar me-1"></i>
                                        <span th:text="${galleryItem.year}">2025</span>
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4 text-md-end mt-2 mt-md-0">
                                <div class="text-muted small">
                                    –°–æ–∑–¥–∞–Ω: <span th:text="${#temporals.format(galleryItem.createdAt, 'dd.MM.yyyy HH:mm')}"></span>
                                    <span th:if="${galleryItem.updatedAt}">
                                        <br>–û–±–Ω–æ–≤–ª–µ–Ω: <span th:text="${#temporals.format(galleryItem.updatedAt, 'dd.MM.yyyy HH:mm')}"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
                    <div class="p-4">
                        <div class="row">

                            <!-- –û–ë–õ–ê–°–¢–¨ –ú–ï–î–ò–ê (–õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
                            <div class="col-lg-8 mb-4">

                                <!-- –§–û–¢–û–ì–†–ê–§–ò–Ø -->
                                <div th:if="${galleryItem.mediaType.name() == 'PHOTO'}">
                                    <h5 class="mb-3 text-primary">
                                        <i class="bi bi-image me-2"></i>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                    </h5>
                                    <div class="text-center">
                                        <img th:src="${galleryItem.imageUrl}"
                                             th:alt="${galleryItem.title}"
                                             class="media-preview img-fluid"
                                             style="max-height: 500px;"
                                             onerror="this.src='https://via.placeholder.com/800x600?text=Image+Not+Found'">
                                    </div>
                                    <div class="mt-3 text-center text-muted">
                                        <small>
                                            <strong>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</strong>
                                            <a th:href="${galleryItem.imageUrl}" target="_blank" th:text="${galleryItem.imageUrl}"></a>
                                        </small>
                                    </div>
                                </div>

                                <!-- –í–ò–î–ï–û -->
                                <div th:if="${galleryItem.mediaType.name() == 'VIDEO'}">
                                    <h5 class="mb-3 text-primary">
                                        <i class="bi bi-play-circle me-2"></i>–í–∏–¥–µ–æ
                                    </h5>

                                    <!-- –ü–†–ï–í–¨–Æ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï –î–õ–Ø –í–ò–î–ï–û -->
                                    <div class="mb-3">
                                        <h6>Preview –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</h6>
                                        <img th:src="${galleryItem.imageUrl}"
                                             th:alt="${galleryItem.title}"
                                             class="media-preview img-fluid"
                                             style="max-height: 300px;"
                                             onerror="this.src='https://via.placeholder.com/800x450?text=Video+Preview+Not+Found'">
                                    </div>

                                    <!-- –°–°–´–õ–ö–ê –ù–ê –í–ò–î–ï–û -->
                                    <div th:if="${galleryItem.videoUrl}">
                                        <h6>–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ:</h6>
                                        <div class="alert alert-info">
                                            <i class="bi bi-link-45deg me-2"></i>
                                            <a th:href="${galleryItem.videoUrl}"
                                               target="_blank"
                                               th:text="${galleryItem.videoUrl}">
                                            </a>
                                        </div>

                                        <!-- –í–°–¢–ê–í–ö–ê YOUTUBE –í–ò–î–ï–û –ï–°–õ–ò –≠–¢–û YOUTUBE –°–°–´–õ–ö–ê -->
                                        <div th:if="${#strings.contains(galleryItem.videoUrl, 'youtube') or #strings.contains(galleryItem.videoUrl, 'youtu.be')}">
                                            <h6 class="mt-3">–í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ:</h6>
                                            <div class="video-container">
                                                <!-- –ü—Ä–æ—Å—Ç–∞—è –≤—Å—Ç–∞–≤–∫–∞ YouTube –≤–∏–¥–µ–æ -->
                                                <iframe th:src="|https://www.youtube.com/embed/${#strings.substringAfter(galleryItem.videoUrl, 'v=')}|"
                                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                                        allowfullscreen>
                                                </iframe>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –û–ü–ò–°–ê–ù–ò–ï -->
                                <div th:if="${galleryItem.description}" class="mt-4">
                                    <h5 class="mb-3 text-primary">
                                        <i class="bi bi-text-paragraph me-2"></i>–û–ø–∏—Å–∞–Ω–∏–µ
                                    </h5>
                                    <div class="border rounded p-3 bg-light">
                                        <p class="mb-0" th:text="${galleryItem.description}">–û–ø–∏—Å–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞</p>
                                    </div>
                                </div>

                                <!-- –°–û–û–ë–©–ï–ù–ò–ï –ï–°–õ–ò –û–ü–ò–°–ê–ù–ò–Ø –ù–ï–¢ -->
                                <div th:unless="${galleryItem.description}" class="mt-4">
                                    <div class="alert alert-warning">
                                        <i class="bi bi-info-circle me-2"></i>
                                        –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–æ.
                                    </div>
                                </div>
                            </div>

                            <!-- –ú–ï–¢–ê–î–ê–ù–ù–´–ï –ò –î–ï–ô–°–¢–í–ò–Ø (–ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê) -->
                            <div class="col-lg-4">
                                <div class="card border-0 bg-light">
                                    <div class="card-body">

                                        <!-- –ú–ï–¢–ê–î–ê–ù–ù–´–ï -->
                                        <h6 class="card-title text-primary mb-3">
                                            <i class="bi bi-info-square me-2"></i>–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        </h6>

                                        <div class="metadata-list">
                                            <div class="metadata-item">
                                                <strong>ID:</strong>
                                                <span class="float-end text-muted" th:text="${galleryItem.id}">1</span>
                                            </div>
                                            <div class="metadata-item">
                                                <strong>–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:</strong>
                                                <span class="float-end text-muted" th:text="${galleryItem.sortOrder}">0</span>
                                            </div>
                                            <div class="metadata-item">
                                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                                                <span class="float-end">
                                                    <span class="badge bg-primary" th:text="${galleryItem.category}"></span>
                                                </span>
                                            </div>
                                            <div class="metadata-item">
                                                <strong>–ì–æ–¥:</strong>
                                                <span class="float-end">
                                                    <span class="badge bg-dark" th:text="${galleryItem.year}"></span>
                                                </span>
                                            </div>
                                            <div class="metadata-item">
                                                <strong>–¢–∏–ø –º–µ–¥–∏–∞:</strong>
                                                <span class="float-end">
                                                    <span th:if="${galleryItem.mediaType.name() == 'PHOTO'}"
                                                          class="badge bg-info">–§–æ—Ç–æ</span>
                                                    <span th:if="${galleryItem.mediaType.name() == 'VIDEO'}"
                                                          class="badge bg-warning text-dark">–í–∏–¥–µ–æ</span>
                                                </span>
                                            </div>
                                            <div class="metadata-item">
                                                <strong>–°—Ç–∞—Ç—É—Å:</strong>
                                                <span class="float-end">
                                                    <span th:if="${galleryItem.published}"
                                                          class="badge bg-success">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                                                    <span th:unless="${galleryItem.published}"
                                                          class="badge bg-secondary">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                                                </span>
                                            </div>
                                            <div class="metadata-item">
                                                <strong>–°–æ–∑–¥–∞–Ω:</strong>
                                                <span class="float-end text-muted small"
                                                      th:text="${#temporals.format(galleryItem.createdAt, 'dd.MM.yyyy HH:mm')}">
                                                </span>
                                            </div>
                                            <div th:if="${galleryItem.updatedAt}" class="metadata-item">
                                                <strong>–û–±–Ω–æ–≤–ª–µ–Ω:</strong>
                                                <span class="float-end text-muted small"
                                                      th:text="${#temporals.format(galleryItem.updatedAt, 'dd.MM.yyyy HH:mm')}">
                                                </span>
                                            </div>
                                        </div>

                                        <!-- –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ -->
                                        <hr class="my-3">

                                        <!-- –î–ï–ô–°–¢–í–ò–Ø -->
                                        <h6 class="card-title text-primary mb-3">
                                            <i class="bi bi-lightning me-2"></i>–î–µ–π—Å—Ç–≤–∏—è
                                        </h6>

                                        <div class="action-buttons d-grid gap-2">
                                            <!-- –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ -->
                                            <a th:href="@{/admin/gallery/edit/{id}(id=${galleryItem.id})}"
                                               class="btn btn-primary">
                                                <i class="bi bi-pencil me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                            </a>

                                            <!-- –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø/–°–ù–Ø–¢–ò–ï -->
                                            <form th:action="@{/admin/gallery/{action}/{id}(action=${galleryItem.published} ? 'unpublish' : 'publish', id=${galleryItem.id})}"
                                                  method="post"
                                                  class="d-grid">
                                                <button type="submit"
                                                        class="btn"
                                                        th:classappend="${galleryItem.published} ? 'btn-warning' : 'btn-success'">
                                                    <i th:classappend="${galleryItem.published} ? 'bi-eye-slash' : 'bi-eye'"
                                                       class="me-2"></i>
                                                    <span th:text="${galleryItem.published} ? '–°–Ω—è—Ç—å —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏' : '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'"></span>
                                                </button>
                                            </form>

                                            <!-- –£–î–ê–õ–ò–¢–¨ -->
                                            <form th:action="@{/admin/gallery/delete/{id}(id=${galleryItem.id})}"
                                                  method="post"
                                                  class="d-grid"
                                                  onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?')">
                                                <button type="submit" class="btn btn-danger">
                                                    <i class="bi bi-trash me-2"></i>–£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </form>

                                            <!-- –ù–ê–ó–ê–î –ö –°–ü–ò–°–ö–£ -->
                                            <a th:href="@{/admin/gallery}" class="btn btn-outline-secondary">
                                                <i class="bi bi-arrow-left me-2"></i>–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /**
     * –û–ë–†–ê–ë–û–¢–ß–ò–ö –°–û–ë–´–¢–ò–ô –î–õ–Ø –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê
     * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
     */
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Gallery preview page loaded');

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        const images = document.querySelectorAll('.media-preview');
        images.forEach(img => {
            img.addEventListener('load', function() {
                console.log('Image loaded successfully:', this.src);
            });

            img.addEventListener('error', function() {
                console.error('Failed to load image:', this.src);
                // –ó–∞–º–µ–Ω—è–µ–º –Ω–∞ placeholder –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
                this.src = 'https://via.placeholder.com/800x600?text=Image+Not+Found';
            });
        });

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
        const deleteForms = document.querySelectorAll('form[onsubmit]');
        deleteForms.forEach(form => {
            form.addEventListener('submit', function(e) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    e.preventDefault();
                }
            });
        });

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const actionButtons = document.querySelectorAll('.action-buttons .btn, .action-buttons form');
        actionButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                console.log('User action:', this.textContent.trim());
            });
        });
    });
</script>
</body>
</html>