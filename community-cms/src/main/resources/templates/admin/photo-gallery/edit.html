<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ - –§–æ—Ç–æ-–≥–∞–ª–µ—Ä–µ—è</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ç–æ-–≥–∞–ª–µ—Ä–µ–∏ -->
    <link rel="stylesheet" th:href="@{/css/photo-gallery.css}">
</head>
<body>
<div layout:fragment="content">
    <!-- ========== –¢–ï–°–¢–û–í–´–ô –ë–õ–û–ö ========== -->
    <div style="position: fixed; top: 0; left: 0; right: 0; background: red; color: white; padding: 20px; z-index: 9999;">
        <h3>üö® –¢–ï–°–¢ THYMELEAF üö®</h3>
        <p>–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: <strong>edit.html</strong></p>
        <p>–î–∞–Ω–Ω—ã–µ: [[${photoGalleryItem?.title}]] (ID: [[${photoGalleryItem?.id}]])</p>
        <button class="btn btn-light">–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∞ 1</button>
        <button class="btn btn-warning">–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∞ 2</button>
    </div>
    <!-- ========== –ö–û–ù–ï–¶ –¢–ï–°–¢–û–í–û–ì–û –ë–õ–û–ö–ê ========== -->

    <div class="container-fluid">
        <!-- ========== –ó–ê–ì–û–õ–û–í–û–ö –§–û–†–ú–´ ========== -->
        <div class="row mb-4">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a th:href="@{/admin/photo-gallery}" class="text-decoration-none">
                                <i class="bi bi-images me-1"></i>
                                –§–æ—Ç–æ-–≥–∞–ª–µ—Ä–µ—è
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <i class="bi bi-pencil me-1"></i>
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                        </li>
                    </ol>
                </nav>

                <div class="d-flex justify-content-between align-items-center">
                    <h1 class="h2 mb-0">
                        <i class="bi bi-pencil-square"></i>
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞
                        <span th:if="${photoGalleryItem?.title}"
                              class="text-muted ms-2"
                              style="font-size: 1rem;">
                            "<span th:text="${photoGalleryItem.title}"></span>"
                        </span>
                    </h1>

                    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" -->
                    <a th:href="@{/admin/photo-gallery}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>
                        –ù–∞–∑–∞–¥
                    </a>
                </div>
            </div>
        </div>

        <!-- ========== –°–û–û–ë–©–ï–ù–ò–Ø –û–ë –£–°–ü–ï–•–ï/–û–®–ò–ë–ö–ï ========== -->
        <div th:if="${successMessage}" class="row mb-3">
            <div class="col-12">
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <span th:text="${successMessage}">–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        </div>

        <div th:if="${errorMessage}" class="row mb-3">
            <div class="col-12">
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <span th:text="${errorMessage}">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        </div>

        <!-- ========== –û–°–ù–û–í–ù–ê–Ø –§–û–†–ú–´ ========== -->
        <form th:action="@{/admin/photo-gallery/edit/{id}(id=${photoGalleryItem.id})}"
              th:object="${photoGalleryItem}"
              method="post"
              enctype="multipart/form-data"
              id="photoGalleryForm"
              novalidate>

            <!-- CSRF —Ç–æ–∫–µ–Ω -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

            <div class="row">
                <!-- ========== –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø ========== -->
                <div class="col-lg-8">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="bi bi-info-circle me-2"></i>
                                –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                            <div class="mb-4">
                                <label for="title" class="form-label fw-semibold">
                                    –ù–∞–∑–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ *
                                </label>
                                <input type="text"
                                       class="form-control"
                                       th:classappend="${#fields.hasErrors('title')} ? 'is-invalid' : ''"
                                       id="title"
                                       th:field="*{title}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞"
                                       required
                                       minlength="3"
                                       maxlength="255">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}">
                                    <span th:errors="*{title}">–û—à–∏–±–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏</span>
                                </div>
                                <div class="form-text">
                                    –ù–∞–∑–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç–µ. –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞.
                                </div>
                            </div>

                            <!-- –ì–æ–¥ -->
                            <div class="mb-4">
                                <label for="year" class="form-label fw-semibold">
                                    –ì–æ–¥ *
                                </label>
                                <input type="number"
                                       class="form-control"
                                       th:classappend="${#fields.hasErrors('year')} ? 'is-invalid' : ''"
                                       id="year"
                                       th:field="*{year}"
                                       placeholder="2024"
                                       required
                                       min="2000"
                                       max="2100"
                                       step="1">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('year')}">
                                    <span th:errors="*{year}">–û—à–∏–±–∫–∞ –≤ –≥–æ–¥–µ</span>
                                </div>
                                <div class="form-text">
                                    –ì–æ–¥ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (2000-2100).
                                </div>
                            </div>

                            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                            <div class="mb-4">
                                <label for="description" class="form-label fw-semibold">
                                    –û–ø–∏—Å–∞–Ω–∏–µ
                                    <span class="text-muted small">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
                                </label>
                                <textarea class="form-control"
                                          th:classappend="${#fields.hasErrors('description')} ? 'is-invalid' : ''"
                                          id="description"
                                          th:field="*{description}"
                                          placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞"
                                          rows="5"
                                          maxlength="2000"
                                          style="resize: vertical;"></textarea>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}">
                                    <span th:errors="*{description}">–û—à–∏–±–∫–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏</span>
                                </div>
                                <div class="form-text">
                                    –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞. –ú–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤.
                                    <span class="d-block mt-1">
                                        <small class="text-muted" id="descriptionCounter">0/2000</small>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ========== –ë–õ–û–ö –ö–ê–¢–ï–ì–û–†–ò–ô ========== -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="bi bi-tags me-2"></i>
                                –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ *
                            </h5>
                        </div>
                        <div class="card-body">
                            <div th:classappend="${#fields.hasErrors('categories')} ? 'border-danger' : ''"
                                 class="border rounded p-3">
                                <div class="row g-3">
                                    <div th:each="category : ${categories}" class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input category-checkbox"
                                                   type="checkbox"
                                                   th:id="'category_' + ${category.id}"
                                                   th:value="${category.id}"
                                                   name="categoryIds"
                                                   th:checked="${selectedCategoryIds != null && selectedCategoryIds.contains(category.id)}">
                                            <label class="form-check-label d-flex align-items-center"
                                                   th:for="'category_' + ${category.id}">
                                                <span class="badge me-2"
                                                      th:class="${category.name == '–ì–ª–∞–≤–Ω–∞—è' ? 'bg-danger' :
                                                                (category.name == '–û –Ω–∞—Å' ? 'bg-success' :
                                                                (category.name == '–ù–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã' ? 'bg-primary' : 'bg-info'))}">
                                                    <span th:text="${category.name}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                                                </span>
                                                <small class="text-muted"
                                                       th:text="${category.description}">
                                                    –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                                </small>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div th:if="${#fields.hasErrors('categories')}" class="mt-2">
                                    <div class="text-danger small">
                                        <i class="bi bi-exclamation-triangle me-1"></i>
                                        <span th:errors="*{categories}">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                                    </div>
                                </div>

                                <div class="mt-3">
                                    <div class="alert alert-info mb-0">
                                        <i class="bi bi-info-circle me-2"></i>
                                        –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —ç–ª–µ–º–µ–Ω—Ç.
                                        –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø –ò –ù–ê–°–¢–†–û–ô–ö–ò ========== -->
                <div class="col-lg-4">
                    <!-- ========== –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–û–í ========== -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="bi bi-images me-2"></i>
                                –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Drag & Drop –∑–æ–Ω–∞ -->
                            <div id="dropzone" class="dropzone-area border rounded p-5 text-center mb-3">
                                <i class="bi bi-cloud-upload display-4 text-muted d-block mb-3"></i>
                                <h5 class="mb-2">
                                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞
                                </h5>
                                <p class="text-muted mb-3">
                                    –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
                                </p>
                                <!-- –í–ê–ñ–ù–û: –∏–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "files", –∫–∞–∫ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ -->
                                <input type="file"
                                       id="fileInput"
                                       name="files"
                                       multiple
                                       accept="image/*"
                                       class="d-none">
                                <button type="button"
                                        class="btn btn-outline-primary"
                                        onclick="document.getElementById('fileInput').click()">
                                    <i class="bi bi-folder2-open me-1"></i>
                                    –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                                </button>
                                <div class="mt-3 text-muted small">
                                    –ú–∞–∫—Å–∏–º—É–º 15 —Ñ–∞–π–ª–æ–≤, –∫–∞–∂–¥—ã–π –¥–æ 5MB. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, GIF, WebP.
                                </div>
                            </div>

                            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ -->
                            <div id="uploadedFiles" class="d-none">
                                <h6 class="mb-3">
                                    <i class="bi bi-list-check me-1"></i>
                                    –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                    <small class="text-muted" id="fileCount">(0)</small>
                                </h6>
                                <div id="fileList" class="list-group mb-3" style="max-height: 300px; overflow-y: auto;">
                                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã -->
                                </div>

                                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                                <div class="d-flex justify-content-between">
                                    <button type="button"
                                            class="btn btn-outline-danger btn-sm"
                                            id="clearAllBtn">
                                        <i class="bi bi-trash me-1"></i>
                                        –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                                    </button>
                                    <button type="button"
                                            class="btn btn-outline-secondary btn-sm"
                                            onclick="sortFiles()">
                                        <i class="bi bi-arrow-down-up me-1"></i>
                                        –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                            </div>

                            <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                            <div th:if="${photoGalleryItem.images != null && !photoGalleryItem.images.isEmpty()}"
                                 class="mt-4">
                                <h6 class="mb-3">
                                    <i class="bi bi-image me-1"></i>
                                    –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                    <small class="text-muted">(<span th:text="${photoGalleryItem.images.size()}">0</span>)</small>
                                </h6>
                                <div class="row g-2 mb-3" id="existingImages">
                                    <div th:each="image : ${photoGalleryItem.images}"
                                         class="col-4">
                                        <div class="position-relative border rounded overflow-hidden">
                                            <!-- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è -->
                                            <img th:src="@{'/static/' + image.filePath}"
                                                 th:alt="${image.fileName}"
                                                 class="img-fluid w-100"
                                                 style="height: 80px; object-fit: cover;">
                                            <div class="position-absolute top-0 end-0 p-1">
                                            <!--    <span th:if="${image.primary}"
                                                      class="badge bg-success">
                                                    <i class="bi bi-star-fill"></i>
                                                </span> -->
                                            </div>
                                            <div class="position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 p-1">
                                                <small class="text-white d-block text-truncate"
                                                       th:text="${image.fileName}">
                                                    —Ñ–∞–π–ª.jpg
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ.
                                </div>
                            </div>

                            <!-- –°—á–µ—Ç—á–∏–∫ —Ñ–∞–π–ª–æ–≤ -->
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:
                                        <span id="currentFileCount"
                                              th:text="${photoGalleryItem.images != null ? photoGalleryItem.images.size() : 0}">
                                            0
                                        </span>
                                        /
                                        <span>15</span>
                                    </small>
                                    <small th:if="${photoGalleryItem.images != null}" class="text-warning">
                                        <i class="bi bi-exclamation-triangle me-1"></i>
                                        –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ
                                        <span th:text="${15 - photoGalleryItem.images.size()}">15</span>
                                        —Ñ–∞–π–ª–æ–≤
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ========== –ù–ê–°–¢–†–û–ô–ö–ò –ü–£–ë–õ–ò–ö–ê–¶–ò–ò ========== -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">
                                <i class="bi bi-gear me-2"></i>
                                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input"
                                       type="checkbox"
                                       role="switch"
                                       id="published"
                                       th:field="*{published}">
                                <label class="form-check-label fw-semibold" for="published">
                                    –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
                                </label>
                                <div class="form-text">
                                    –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ, —ç–ª–µ–º–µ–Ω—Ç –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ.
                                </div>
                            </div>

                            <!-- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏) -->
                            <div th:if="${photoGalleryItem.createdAt}" class="mb-3">
                                <label class="form-label fw-semibold">
                                    –°–æ–∑–¥–∞–Ω–æ
                                </label>
                                <div class="form-control bg-light">
                                    <i class="bi bi-calendar me-1"></i>
                                    <span th:text="${#temporals.format(photoGalleryItem.createdAt, 'dd.MM.yyyy HH:mm')}">
                                        01.01.2024 12:00
                                    </span>
                                </div>
                            </div>

                            <!-- –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏) -->
                            <div th:if="${photoGalleryItem.updatedAt}" class="mb-3">
                                <label class="form-label fw-semibold">
                                    –û–±–Ω–æ–≤–ª–µ–Ω–æ
                                </label>
                                <div class="form-control bg-light">
                                    <i class="bi bi-clock-history me-1"></i>
                                    <span th:text="${#temporals.format(photoGalleryItem.updatedAt, 'dd.MM.yyyy HH:mm')}">
                                        01.01.2024 12:00
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- ========== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–ï–†–ï–î –ö–ù–û–ü–ö–ê–ú–ò ========== -->
                    <div style="background: purple; color: white; padding: 20px; margin: 20px 0; border: 5px solid yellow;">
                        <h3>üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –≠—Ç–∞ —Ç–æ—á–∫–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞?</h3>
                        <p>–ï—Å–ª–∏ —ç—Ç–æ—Ç –±–ª–æ–∫ –í–ò–î–ï–ù - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –±–ª–æ–∫–µ –∫–Ω–æ–ø–æ–∫</p>
                        <p>–ï—Å–ª–∏ —ç—Ç–æ—Ç –±–ª–æ–∫ –ù–ï –í–ò–î–ï–ù - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –î–û –Ω–µ–≥–æ</p>
                        <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: [[${photoGalleryItem.images != null ? photoGalleryItem.images.size() : 0}]]</p>
                    </div>
                    <!-- ========== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ========== -->






                    <!-- ========== –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô ========== -->
                    <div class="sticky-top" style="top: 20px; z-index: 1000; border: 3px solid lime !important;">
                        <div class="card border-0 shadow-sm" style="border: 2px solid red !important;">
                            <div class="card-body" style="background: cyan !important;">
                                <div class="d-grid gap-2">
                                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
                                    <button type="submit"
                                            class="btn btn-primary btn-lg"
                                            id="submitBtn">
                                        <i class="bi bi-check-circle"></i>
                                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                    </button>

                                    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã -->
                                    <a th:href="@{/admin/photo-gallery}"
                                       class="btn btn-outline-secondary">
                                        <i class="bi bi-x-circle me-1"></i>
                                        –û—Ç–º–µ–Ω–∞
                                    </a>

                                    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                                    <button type="button"
                                            class="btn btn-outline-danger mt-3"
                                            id="deleteBtn"
                                            data-bs-toggle="modal"
                                            data-bs-target="#deleteModal">
                                        <i class="bi bi-trash me-1"></i>
                                        –£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
                                    </button>
                                </div>

                                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
                                <div class="mt-3">
                                    <div class="alert alert-warning mb-0 d-none" id="validationAlert">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º—É. –ï—Å—Ç—å –æ—à–∏–±–∫–∏ –∏–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- –∑–∞–∫—Ä—ã—Ç–∏–µ col-lg-4 -->
            </div> <!-- –∑–∞–∫—Ä—ã—Ç–∏–µ row -->
        </form> <!-- –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã -->
    </div> <!-- –∑–∞–∫—Ä—ã—Ç–∏–µ container-fluid -->

    <!-- ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø ========== -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle text-danger me-2"></i>
                        –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>
                        –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?
                    </p>
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-octagon-fill me-2"></i>
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong>
                        –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º.
                    </div>
                    <div th:if="${photoGalleryItem?.title}" class="mt-3">
                        <p class="mb-0">
                            <strong>–≠–ª–µ–º–µ–Ω—Ç:</strong>
                            "<span th:text="${photoGalleryItem.title}"></span>"
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <form th:action="@{/admin/photo-gallery/delete/{id}(id=${photoGalleryItem.id})}"
                          method="post"
                          class="d-inline">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash me-1"></i>
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div> <!-- –∑–∞–∫—Ä—ã—Ç–∏–µ layout:fragment="content" -->

<!-- ========== –£–ü–†–û–©–ï–ù–ù–´–ô JAVASCRIPT –î–õ–Ø –§–û–†–ú–´ ========== -->
<script th:inline="javascript">
    /*<![CDATA[*/

    document.addEventListener('DOMContentLoaded', function() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');
        initFormValidation();
        initFileUpload();
        initDescriptionCounter();
        initCategoryValidation();
    });

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
     */
    function initFormValidation() {
        const form = document.getElementById('photoGalleryForm');
        const validationAlert = document.getElementById('validationAlert');
        const submitBtn = document.getElementById('submitBtn');

        if (!form) {
            console.error('–§–æ—Ä–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            return;
        }

        form.addEventListener('submit', function(event) {
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');

            if (!validateForm()) {
                event.preventDefault();
                event.stopPropagation();

                if (validationAlert) {
                    validationAlert.classList.remove('d-none');
                    validationAlert.scrollIntoView({ behavior: 'smooth' });
                }

                form.classList.add('was-validated');
            } else {
                console.log('–§–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞...');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
                    `;
                }
            }
        });
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã (–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
     */
    function validateForm() {
        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');
        let isValid = true;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
        const title = document.getElementById('title');
        const year = document.getElementById('year');

        if (!title || !title.value.trim()) {
            title.classList.add('is-invalid');
            isValid = false;
        }

        if (!year || !year.value.trim()) {
            year.classList.add('is-invalid');
            isValid = false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        const categoryCheckboxes = document.querySelectorAll('.category-checkbox:checked');
        if (categoryCheckboxes.length === 0) {
            const categoryContainer = document.querySelector('.border.rounded.p-3');
            if (categoryContainer) {
                categoryContainer.classList.add('border-danger');
            }
            isValid = false;
        }

        console.log('–§–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞:', isValid);
        return isValid;
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ (–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
     */
    function initFileUpload() {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');

        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const uploadedFiles = document.getElementById('uploadedFiles');
        const fileList = document.getElementById('fileList');
        const fileCount = document.getElementById('fileCount');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const currentFileCount = document.getElementById('currentFileCount');

        if (!fileInput) {
            console.error('–ü–æ–ª–µ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            return;
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
        const existingCount = parseInt(currentFileCount.textContent) || 0;
        if (currentFileCount) {
            currentFileCount.setAttribute('data-existing', existingCount);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
        fileInput.addEventListener('change', function(e) {
            console.log('–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:', e.target.files.length);
            displaySelectedFiles(e.target.files);
        });

        // Drag & Drop —Å–æ–±—ã—Ç–∏—è
        if (dropzone) {
            dropzone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropzone.classList.add('dragover');
            });

            dropzone.addEventListener('dragleave', function() {
                dropzone.classList.remove('dragover');
            });

            dropzone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropzone.classList.remove('dragover');

                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    fileInput.dispatchEvent(new Event('change'));
                }
            });

            // –ö–ª–∏–∫ –ø–æ –∑–æ–Ω–µ drop
            dropzone.addEventListener('click', function() {
                fileInput.click();
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
        if (clearAllBtn) {
            clearAllBtn.addEventListener('click', function() {
                if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã?')) {
                    fileInput.value = '';
                    fileList.innerHTML = '';
                    uploadedFiles.classList.add('d-none');
                    if (fileCount) fileCount.textContent = '(0)';
                    if (currentFileCount) {
                        currentFileCount.textContent = existingCount;
                    }
                }
            });
        }

        /**
         * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
         */
        function displaySelectedFiles(files) {
            if (!files || files.length === 0) {
                uploadedFiles.classList.add('d-none');
                return;
            }

            fileList.innerHTML = '';
            let validFiles = 0;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç —Ñ–∞–π–ª–æ–≤
            const maxFiles = 15;
            const existingCount = parseInt(currentFileCount.getAttribute('data-existing') || '0');

            if (files.length + existingCount > maxFiles) {
                alert(`–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤: ${maxFiles}. –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å ${existingCount} —Ñ–∞–π–ª–æ–≤, –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ ${files.length}.`);
                return;
            }

            for (let i = 0; i < files.length; i++) {
                const file = files[i];

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
                if (!file.type.startsWith('image/')) {
                    alert(`–§–∞–π–ª "${file.name}" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω.`);
                    continue;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                if (file.size > 5 * 1024 * 1024) {
                    alert(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (${(file.size / (1024 * 1024)).toFixed(2)} MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB.`);
                    continue;
                }

                validFiles++;

                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ñ–∞–π–ª–∞
                const fileElement = document.createElement('div');
                fileElement.className = 'list-group-item';
                fileElement.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="bi bi-image text-primary me-3" style="font-size: 1.5rem;"></i>
                        <div style="flex: 1;">
                            <div class="fw-semibold text-truncate" title="${file.name}">
                                ${file.name}
                            </div>
                            <div class="small text-muted">
                                ${(file.size / 1024).toFixed(1)} KB
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeFile(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;

                fileList.appendChild(fileElement);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            if (validFiles > 0) {
                uploadedFiles.classList.remove('d-none');
                if (fileCount) fileCount.textContent = `(${validFiles})`;
                if (currentFileCount) {
                    currentFileCount.textContent = validFiles + existingCount;
                }
            } else {
                uploadedFiles.classList.add('d-none');
            }
        }
    }

    /**
     * –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
     */
    window.removeFile = function(button) {
        const fileItem = button.closest('.list-group-item');
        if (fileItem) {
            fileItem.remove();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            const fileList = document.getElementById('fileList');
            const fileCount = document.getElementById('fileCount');
            const currentFileCount = document.getElementById('currentFileCount');
            const existingCount = parseInt(currentFileCount.getAttribute('data-existing') || '0');

            const remainingFiles = fileList.children.length;

            if (fileCount) fileCount.textContent = `(${remainingFiles})`;
            if (currentFileCount) currentFileCount.textContent = remainingFiles + existingCount;

            if (remainingFiles === 0) {
                document.getElementById('uploadedFiles').classList.add('d-none');
            }
        }
    };

    /**
     * –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ –∏–º–µ–Ω–∏
     */
    window.sortFiles = function() {
        const fileList = document.getElementById('fileList');
        if (!fileList) return;

        const items = Array.from(fileList.children);

        items.sort((a, b) => {
            const nameA = a.querySelector('.fw-semibold').title.toLowerCase();
            const nameB = b.querySelector('.fw-semibold').title.toLowerCase();
            return nameA.localeCompare(nameB);
        });

        // –û—á–∏—â–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        fileList.innerHTML = '';
        items.forEach(item => fileList.appendChild(item));
    };

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
     */
    function initDescriptionCounter() {
        const description = document.getElementById('description');
        const counter = document.getElementById('descriptionCounter');

        if (description && counter) {
            updateCounter();
            description.addEventListener('input', updateCounter);

            function updateCounter() {
                const length = description.value.length;
                counter.textContent = `${length}/2000`;
                counter.classList.toggle('text-danger', length > 2000);
            }
        }
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
     */
    function initCategoryValidation() {
        const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
        const categoryContainer = document.querySelector('.border.rounded.p-3');

        if (categoryCheckboxes && categoryContainer) {
            categoryCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const checkedCount = document.querySelectorAll('.category-checkbox:checked').length;
                    if (checkedCount > 0) {
                        categoryContainer.classList.remove('border-danger');
                    }
                });
            });
        }
    }

    /*]]>*/
</script>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã -->
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è Drag & Drop –∑–æ–Ω—ã */
    .dropzone-area {
        border: 2px dashed #dee2e6;
        background-color: #f8f9fa;
        transition: all 0.3s ease;
        cursor: pointer;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .dropzone-area:hover,
    .dropzone-area.dragover {
        border-color: #0d6efd;
        background-color: #e7f1ff;
    }

    .dropzone-area.border-danger {
        border-color: #dc3545;
        background-color: #f8d7da;
    }

    .dragover {
        border-color: #0d6efd !important;
        background-color: #e7f1ff !important;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ */
    #fileList {
        scrollbar-width: thin;
        scrollbar-color: #adb5bd #f8f9fa;
    }

    #fileList::-webkit-scrollbar {
        width: 8px;
    }

    #fileList::-webkit-scrollbar-track {
        background: #f8f9fa;
        border-radius: 4px;
    }

    #fileList::-webkit-scrollbar-thumb {
        background: #adb5bd;
        border-radius: 4px;
    }

    #fileList::-webkit-scrollbar-thumb:hover {
        background: #6c757d;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    @media (max-width: 992px) {
        .sticky-top {
            position: static !important;
        }
    }
</style>
</body>
</html>