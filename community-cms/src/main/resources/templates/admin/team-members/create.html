<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>Создание члена команды - Админ панель</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        .team-create-container {
            max-width: 900px;
            margin: 0 auto;
            padding-left: 20px;
            padding-right: 20px;
        }

        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #495057;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #0d6efd;
        }

        .required-field::after {
            content: " *";
            color: #dc3545;
        }

        .avatar-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #dee2e6;
            background-color: #f8f9fa;
        }

        .avatar-placeholder-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #6c757d;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            border: 3px solid #dee2e6;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container-fluid team-create-container">

        <!-- ========== ЗАГОЛОВОК И НАВИГАЦИЯ ========== -->
        <div class="row mb-4">
            <div class="col-12">
                <!-- Хлебные крошки -->
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a th:href="@{/admin}">Главная</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a th:href="@{/admin/team-members}">Команда</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            Создание члена команды
                        </li>
                    </ol>
                </nav>

                <!-- Заголовок -->
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h2 mb-0">
                            <i class="bi bi-person-plus me-2"></i>
                            Создание члена команды
                        </h1>
                        <p class="text-muted mb-0 mt-1">
                            Добавление нового члена команды организации "ЛАДА"
                        </p>
                    </div>
                    <div>
                        <a th:href="@{/admin/team-members}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-1"></i>
                            Назад к списку
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== СООБЩЕНИЯ ОБ ОШИБКАХ ========== -->
        <div class="row mb-4" th:if="${errorMessage}">
            <div class="col-12">
                <div class="alert alert-danger alert-dismissible fade show">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <span th:text="${errorMessage}">Ошибка!</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        </div>

        <!-- ========== ОСНОВНАЯ ФОРМА ========== -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <!-- Форма создания -->
                        <form th:action="@{/admin/team-members/create}"
                              th:object="${teamMember}"
                              method="post"
                              enctype="multipart/form-data">

                            <!-- Скрытый CSRF токен -->
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                            <!-- ===== СЕКЦИЯ 1: ОСНОВНАЯ ИНФОРМАЦИЯ ===== -->
                            <div class="form-section">
                                <h3 class="form-section-title">
                                    <i class="bi bi-person-circle me-2"></i>
                                    Основная информация
                                </h3>

                                <div class="row">
                                    <!-- Полное имя -->
                                    <div class="col-md-6 mb-3">
                                        <label for="fullName" class="form-label required-field">
                                            Полное имя
                                        </label>
                                        <input type="text"
                                               class="form-control"
                                               id="fullName"
                                               th:field="*{fullName}"
                                               placeholder="Иванов Иван Иванович"
                                               required>
                                        <div class="form-text">
                                            Фамилия Имя Отчество полностью
                                        </div>
                                        <div th:if="${#fields.hasErrors('fullName')}" class="text-danger small">
                                            <span th:errors="*{fullName}"></span>
                                        </div>
                                    </div>

                                    <!-- Должность -->
                                    <div class="col-md-6 mb-3">
                                        <label for="position" class="form-label required-field">
                                            Должность
                                        </label>
                                        <input type="text"
                                               class="form-control"
                                               id="position"
                                               th:field="*{position}"
                                               placeholder="Руководитель проекта"
                                               required>
                                        <div class="form-text">
                                            Основная должность в организации
                                        </div>
                                        <div th:if="${#fields.hasErrors('position')}" class="text-danger small">
                                            <span th:errors="*{position}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===== СЕКЦИЯ 2: АВАТАР ===== -->
                            <div class="form-section">
                                <h3 class="form-section-title">
                                    <i class="bi bi-image me-2"></i>
                                    Фотография (аватар)
                                </h3>

                                <div class="row align-items-center">
                                    <!-- Превью аватара -->
                                    <div class="col-md-4 text-center mb-3">
                                        <div id="avatarPreviewContainer">
                                            <div class="avatar-placeholder-large mb-2">
                                                <i class="bi bi-person"></i>
                                            </div>
                                            <p class="text-muted small">Превью будет отображено после выбора файла</p>
                                        </div>
                                    </div>

                                    <!-- Поле загрузки -->
                                    <div class="col-md-8 mb-3">
                                        <label for="avatarFile" class="form-label">
                                            Загрузить фото
                                        </label>
                                        <input type="file"
                                               class="form-control"
                                               id="avatarFile"
                                               name="avatarFile"
                                               accept="image/*">
                                        <div class="form-text">
                                            Рекомендуемый размер: 400x400px. Форматы: JPG, PNG
                                        </div>

                                        <!-- Ссылка на существующее фото (если редактирование) -->
                                        <input type="hidden" id="avatarPath" th:field="*{avatarPath}">
                                    </div>
                                </div>
                            </div>

                            <!-- ===== СЕКЦИЯ 3: КОНТАКТНАЯ ИНФОРМАЦИЯ ===== -->
                            <div class="form-section">
                                <h3 class="form-section-title">
                                    <i class="bi bi-envelope me-2"></i>
                                    Контактная информация
                                </h3>

                                <div class="row">
                                    <!-- Email -->
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label">
                                            Электронная почта
                                        </label>
                                        <input type="email"
                                               class="form-control"
                                               id="email"
                                               th:field="*{email}"
                                               placeholder="ivanov@example.com">
                                        <div class="form-text">
                                            Рабочий email адрес
                                        </div>
                                        <div th:if="${#fields.hasErrors('email')}" class="text-danger small">
                                            <span th:errors="*{email}"></span>
                                        </div>
                                    </div>

                                    <!-- Телефон -->
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label">
                                            Телефон
                                        </label>
                                        <input type="tel"
                                               class="form-control"
                                               id="phone"
                                               th:field="*{phone}"
                                               placeholder="+7 (XXX) XXX-XX-XX">
                                        <div class="form-text">
                                            Рабочий номер телефона
                                        </div>
                                        <div th:if="${#fields.hasErrors('phone')}" class="text-danger small">
                                            <span th:errors="*{phone}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===== СЕКЦИЯ 4: БИОГРАФИЯ ===== -->
                            <div class="form-section">
                                <h3 class="form-section-title">
                                    <i class="bi bi-file-text me-2"></i>
                                    Биография
                                </h3>

                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="bio" class="form-label">
                                            Биография
                                        </label>
                                        <textarea class="form-control"
                                                  id="bio"
                                                  th:field="*{bio}"
                                                  rows="5"
                                                  placeholder="Опыт работы, образование, достижения..."></textarea>
                                        <div class="form-text">
                                            Можно использовать HTML-разметку для форматирования
                                        </div>
                                        <div th:if="${#fields.hasErrors('bio')}" class="text-danger small">
                                            <span th:errors="*{bio}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===== СЕКЦИЯ 5: НАСТРОЙКИ ===== -->
                            <div class="form-section">
                                <h3 class="form-section-title">
                                    <i class="bi bi-gear me-2"></i>
                                    Настройки
                                </h3>

                                <div class="row">
                                    <!-- Порядок сортировки -->
                                    <div class="col-md-4 mb-3">
                                        <label for="sortOrder" class="form-label">
                                            Порядок сортировки
                                        </label>
                                        <input type="number"
                                               class="form-control"
                                               id="sortOrder"
                                               th:field="*{sortOrder}"
                                               min="0"
                                               max="999"
                                               value="0">
                                        <div class="form-text">
                                            Меньшее число = выше в списке
                                        </div>
                                        <div th:if="${#fields.hasErrors('sortOrder')}" class="text-danger small">
                                            <span th:errors="*{sortOrder}"></span>
                                        </div>
                                    </div>

                                    <!-- Статус активности -->
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Статус</label>
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                   type="checkbox"
                                                   id="active"
                                                   th:field="*{active}"
                                                   checked>
                                            <label class="form-check-label" for="active">
                                                Активный член команды
                                            </label>
                                        </div>
                                        <div class="form-text">
                                            Неактивные не отображаются на сайте
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===== КНОПКИ ДЕЙСТВИЙ ===== -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between">
                                        <a th:href="@{/admin/team-members}" class="btn btn-outline-secondary">
                                            <i class="bi bi-x-circle me-1"></i>
                                            Отмена
                                        </a>
                                        <div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-check-circle me-1"></i>
                                                Создать члена команды
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Информационная панель -->
                <div class="card mt-4">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-info-circle me-2"></i>
                            Подсказки по заполнению
                        </h5>
                        <ul class="mb-0">
                            <li><strong>Обязательные поля</strong> отмечены звёздочкой (*)</li>
                            <li><strong>Порядок сортировки</strong> определяет положение в списке команды</li>
                            <li><strong>Биография</strong> поддерживает HTML-разметку для форматирования</li>
                            <li><strong>Аватар</strong> можно добавить позже при редактировании</li>
                            <li><strong>Проекты</strong> можно назначить после создания члена команды</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript для предпросмотра аватара -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Страница создания члена команды загружена');

        // Предпросмотр аватара
        const avatarFileInput = document.getElementById('avatarFile');
        const avatarPreviewContainer = document.getElementById('avatarPreviewContainer');

        if (avatarFileInput) {
            avatarFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        // Создаем изображение для предпросмотра
                        avatarPreviewContainer.innerHTML = `
                            <img src="${e.target.result}"
                                 class="avatar-preview mb-2"
                                 alt="Предпросмотр аватара">
                            <p class="text-success small">
                                <i class="bi bi-check-circle me-1"></i>
                                Фото выбрано
                            </p>
                        `;
                    };

                    reader.readAsDataURL(file);
                } else {
                    // Если файл не выбран, показываем заглушку
                    avatarPreviewContainer.innerHTML = `
                        <div class="avatar-placeholder-large mb-2">
                            <i class="bi bi-person"></i>
                        </div>
                        <p class="text-muted small">Превью будет отображено после выбора файла</p>
                    `;
                }
            });
        }

        // Автоматическое определение инициалов из имени
        const fullNameInput = document.getElementById('fullName');
        const avatarPlaceholder = document.querySelector('.avatar-placeholder-large');

        if (fullNameInput && avatarPlaceholder) {
            fullNameInput.addEventListener('input', function() {
                const name = this.value.trim();
                if (name) {
                    // Берем первые буквы первых двух слов
                    const words = name.split(' ');
                    let initials = '';

                    if (words.length >= 2) {
                        initials = (words[0].charAt(0) + words[1].charAt(0)).toUpperCase();
                    } else if (words.length === 1) {
                        initials = words[0].charAt(0).toUpperCase();
                    }

                    // Обновляем заглушку
                    avatarPlaceholder.textContent = initials;
                } else {
                    avatarPlaceholder.innerHTML = '<i class="bi bi-person"></i>';
                }
            });
        }

        // Валидация формы перед отправкой
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                const fullName = document.getElementById('fullName').value.trim();
                const position = document.getElementById('position').value.trim();

                if (!fullName || !position) {
                    e.preventDefault();
                    alert('Пожалуйста, заполните обязательные поля: Полное имя и Должность');
                    return false;
                }

                return true;
            });
        }
    });
</script>
</body>
</html>